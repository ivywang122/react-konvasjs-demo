(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{43:function(e,n,t){e.exports=t(97)},96:function(e,n,t){},97:function(e,n,t){"use strict";t.r(n);var o=t(0),a=t.n(o),i=t(23),r=t.n(i),l=t(9),c=t(24),s=t(13),u=t(14),d=t(16),m=t(15),p=t(17),g=t(5),f=t(11),h=t(22),v=t.n(h),b=t(10),k=t(18),w=t.n(k),y=function(e){function n(e){var t;return Object(s.a)(this,n),(t=Object(d.a)(this,Object(m.a)(n).call(this,e))).state={posX:t.props.posX,posY:t.props.posY,fillColor:"gold"},t}return Object(p.a)(n,e),Object(u.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidUpdate",value:function(e,n){}},{key:"shouldComponentUpdate",value:function(e,n){return this.state!==n}},{key:"render",value:function(){var e=this.state,n=e.posX,t=e.posY,o=e.fillColor;return a.a.createElement(b.Circle,{x:n,y:t,radius:5,fill:o})}}]),n}(o.Component),C=t(8);function j(){var e=Object(l.a)(["\n  background-color: gray;\n  flex: 50%;\n  padding-bottom: 50%;\n  box-shadow: 0 0 0 5px #fff;\n  background-image: ",";\n  background-size: cover;\n  background-position: 50% 50%;\n"]);return j=function(){return e},e}function x(){var e=Object(l.a)(["\n  width: 300px;\n  height: 300px;\n  padding: 30px;\n  position: relative;\n  background-color: #fff;\n  border-radius: 3px;\n  box-shadow: 0 0 20px 0 rgba(0,0,0,.5);\n  .fa-icon{\n    position: absolute;\n    right: 10px;\n    top: 10px;\n    cursor: pointer;\n  }\n  .options-container{\n    width: 100%;\n    height: 100%;\n    .options-row-wrapper{\n      display: flex;\n    }\n  }\n"]);return x=function(){return e},e}function O(){var e=Object(l.a)(["\n  position: fixed;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 2;\n  width: 100%;\n  height: 100vh;\n  background-color: rgba(0,0,0, 0.7);\n"]);return O=function(){return e},e}var E=function(e){function n(e){var t;return Object(s.a)(this,n),(t=Object(d.a)(this,Object(m.a)(n).call(this,e))).state={},t}return Object(p.a)(n,e),Object(u.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidUpdate",value:function(e,n){}},{key:"shouldComponentUpdate",value:function(e,n){return this.state!==n}},{key:"render",value:function(){var e=this,n="https://fakeimg.pl/800x600/121258/FFC039",t="https://fakeimg.pl/800x600/FF5126/162C9B",o="https://fakeimg.pl/800x600/6CC3C1/EF7352",i="https://fakeimg.pl/800x600/f55071/FBC52f";return a.a.createElement(S,null,a.a.createElement(I,null,a.a.createElement(C.j,{className:"fa-icon",onClick:this.props.onCloseImgBox}),a.a.createElement("div",{className:"options-container"},a.a.createElement("div",{className:"options-row-wrapper"},a.a.createElement(_,{onClick:function(){return e.props.onImgSelect(n)},imgurl:n}),a.a.createElement(_,{onClick:function(){return e.props.onImgSelect(t)},imgurl:t})),a.a.createElement("div",{className:"options-row-wrapper"},a.a.createElement(_,{onClick:function(){return e.props.onImgSelect(o)},imgurl:o}),a.a.createElement(_,{onClick:function(){return e.props.onImgSelect(i)},imgurl:i})))))}}]),n}(o.Component),S=f.a.div(O()),I=f.a.div(x()),_=f.a.div(j(),function(e){return e.imgurl?"url("+e.imgurl+")":null}),D=E;function M(){var e=Object(l.a)(["\n  width: 100%;\n  height: 40px;\n  font-size: 18px;\n  color: #1a1a1a;\n  background-color: #efefef;\n  border-bottom: 1px solid #e0e0e0;\n  display: flex;\n  justify-content: space-between;\n  .icon-wrapper {\n    display: inline-block;\n    text-align: center;\n    line-height: 40px;\n    height: 40px;\n    width: 40px;\n    cursor: pointer;\n    &.active,\n    &:hover {\n      background-color: #ddd;\n    }\n  }\n"]);return M=function(){return e},e}function R(){var e=Object(l.a)(["\n  width: 100%;\n  height: 100vh;\n  background-color: goldenrod;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  .frame {\n    background-color: #fff;\n    box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.5);\n  }\n"]);return R=function(){return e},e}var U=function(e){function n(e){var t;return Object(s.a)(this,n),(t=Object(d.a)(this,Object(m.a)(n).call(this,e))).onMouseDown=t._onMouseDown.bind(Object(g.a)(Object(g.a)(t))),t.onMouseMove=t._onMouseMove.bind(Object(g.a)(Object(g.a)(t))),t.onMouseUp=t._onMouseUp.bind(Object(g.a)(Object(g.a)(t))),t.onToolChange=t._onToolChange.bind(Object(g.a)(Object(g.a)(t))),t.onImgSelect=t._onImgSelect.bind(Object(g.a)(Object(g.a)(t))),t.onStageClick=t._onStageClick.bind(Object(g.a)(Object(g.a)(t))),t.renderDots=t._renderDots.bind(Object(g.a)(Object(g.a)(t))),t.onUndo=t._onUndo.bind(Object(g.a)(Object(g.a)(t))),t.onRedo=t._onRedo.bind(Object(g.a)(Object(g.a)(t))),t.onShowImgBox=t._onShowImgBox.bind(Object(g.a)(Object(g.a)(t))),t.onCloseImgBox=t._onCloseImgBox.bind(Object(g.a)(Object(g.a)(t))),t.onDownload=t._onDownload.bind(Object(g.a)(Object(g.a)(t))),t.onAllClear=t._onAllClear.bind(Object(g.a)(Object(g.a)(t))),t.downloadURI=t._downloadURI.bind(Object(g.a)(Object(g.a)(t))),t.state={lines:[],eraseImgs:[],dots:[],opacity:1,posX:0,posY:0,isDrawing:!1,isErasing:!1,toolState:0,isShowImgSelectBox:!1,historyStep:0,history:[],imgurl:"",isBgImg:!1,imgId:void 0},t}return Object(p.a)(n,e),Object(u.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this,n=this.state,t=n.toolState,o=n.dots,i=n.isShowImgSelectBox,r=n.lines,l=n.eraseImgs;return a.a.createElement("div",{className:"App"},i?a.a.createElement(D,{onImgSelect:this.onImgSelect,onCloseImgBox:this.onCloseImgBox}):null,a.a.createElement(B,null,a.a.createElement("div",{className:"frame"},a.a.createElement(N,null,a.a.createElement("div",{className:"left"},a.a.createElement("div",{className:w()("icon-wrapper",{active:0===t}),onClick:function(){return e.onToolChange(0)}},a.a.createElement(C.c,null)),a.a.createElement("div",{className:w()("icon-wrapper",{active:1===t}),onClick:function(){return e.onToolChange(1)}},a.a.createElement(C.d,null)),a.a.createElement("div",{className:w()("icon-wrapper",{active:2===t}),onClick:function(){return e.onToolChange(2)}},a.a.createElement(C.b,null)),a.a.createElement("div",{className:"icon-wrapper",onClick:this.onShowImgBox},a.a.createElement(C.f,null)),a.a.createElement("div",{className:w()("icon-wrapper",{active:3===t}),onClick:function(){return e.onToolChange(3)}},a.a.createElement(C.e,null))),a.a.createElement("div",{className:"right"},a.a.createElement("div",{className:"icon-wrapper",onClick:this.onAllClear},a.a.createElement(C.k,null)),a.a.createElement("div",{className:w()("icon-wrapper",{active:4===t}),onClick:function(){return e.onToolChange(4)}},a.a.createElement(C.a,null)),a.a.createElement("div",{className:"icon-wrapper",onClick:this.onRedo},a.a.createElement(C.i,null)),a.a.createElement("div",{className:"icon-wrapper",onClick:this.onUndo},a.a.createElement(C.g,null)),a.a.createElement("div",{className:"icon-wrapper",onClick:this.onDownload},a.a.createElement(C.h,null)))),a.a.createElement(b.Stage,{ref:function(n){e.stageRef=n},width:800,height:600,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp,onClick:this.onStageClick},a.a.createElement(b.Layer,{ref:function(n){e.layerRef=n}},o.length>0?o.map(function(n,t){return e.renderDots(n,t)}):null,r.length>0?r.map(function(e,n){return a.a.createElement(b.Line,{key:"line"+n,lineJoin:"round",lineCap:"round",strokeWidth:5,points:e,stroke:"gold"})}):null,l.length>0?l.map(function(n,t){return a.a.createElement(b.Image,{key:"img"+t,ref:function(n){return e.imageRef=n},x:n.x,y:n.y,width:10,height:10,stroke:"blue",fill:"red",globalCompositeOperation:"destination-out"})}):null)))))}},{key:"_renderDots",value:function(e,n){return a.a.createElement(y,{key:"dot-"+n,posX:e.posX,posY:e.posY})}},{key:"_onMouseMove",value:function(e){var n=this.state,t=n.toolState,o=n.isDrawing,a=n.isErasing,i=n.lines,r=n.eraseImgs,l=this.stageRef.getStage().getPointerPosition();if(1===t){if(!o)return;var s=i[i.length-1];s=s.concat([l.x,l.y]),i.splice(i.length-1,1,s),this.setState({lines:i.concat()})}else if(4===t){if(!a)return;var u={x:l.x,y:l.y};r=[].concat(Object(c.a)(r),[u]),this.setState({eraseImgs:r})}}},{key:"_onMouseDown",value:function(){var e=this.state,n=e.toolState,t=e.lines;1===n?this.setState({isDrawing:!0,lines:[].concat(Object(c.a)(t),[[]])}):4===n&&this.setState({isErasing:!0})}},{key:"_onMouseUp",value:function(){this.setState({isDrawing:!1,isErasing:!1})}},{key:"_onToolChange",value:function(e){this.setState({toolState:e})}},{key:"_onImgSelect",value:function(e){if(this.layerRef.getChildren()[0])for(var n=this.layerRef.getChildren(function(e){return"Image"===e.getClassName()}),t=0;t<n.length;t++)if(n[t]._id===this.state.imgId){n[t].destroy(),this.layerRef.draw();break}this.layerRef.getCanvas()._canvas.setAttribute("style","background: url("+e+")"),this.setState({imgurl:e,isShowImgSelectBox:!1,isBgImg:!0})}},{key:"_onStageClick",value:function(e){var n=this.state,t=n.toolState,o=n.dots,a={};0===t&&(a={posX:e.evt.offsetX,posY:e.evt.offsetY},o=[].concat(Object(c.a)(o),[a])),this.setState({dots:o})}},{key:"_onUndo",value:function(){}},{key:"_onRedo",value:function(){}},{key:"_onAllClear",value:function(){this.setState({dots:[],lines:[],eraseImgs:[]})}},{key:"_onShowImgBox",value:function(){this.setState({isShowImgSelectBox:!0})}},{key:"_onCloseImgBox",value:function(){this.setState({isShowImgSelectBox:!1})}},{key:"_onDownload",value:function(){var e=this,n=this.state,t=n.imgurl;if(n.isBgImg){var o=new window.Image;o.setAttribute("crossOrigin","anonymous"),o.src=t,o.width=800,o.height=600,o.onload=function(){var n=new v.a.Image({x:0,y:0,image:o,opacity:1,globalCompositeOperation:"destination-over"});e.layerRef.add(n),e.layerRef.draw(),e.setState({imgId:n._id}),setTimeout(function(){var n=e.stageRef.toDataURL();e.downloadURI(n,"stage.png")},100)}}else setTimeout(function(){var n=e.stageRef.toDataURL();e.downloadURI(n,"stage.png")},100)}},{key:"_downloadURI",value:function(e,n){var t=document.createElement("a");t.download=n,t.href=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}]),n}(o.Component),B=f.a.div(R()),N=f.a.div(M()),T=U;t(96),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(T,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[43,1,2]]]);
//# sourceMappingURL=main.59e5405c.chunk.js.map